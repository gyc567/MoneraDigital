# OpenSpec: 修复 Vercel 生产环境注册接口 500 崩溃

## 1. 问题描述
- **现象**: 线上 `POST /api/auth/register` 返回 500，报错 `FUNCTION_INVOCATION_FAILED`。
- **环境差异**: 本地 `tsx` 运行正常，但 Vercel Node.js 运行时失败。

## 2. 假设原因与排除步骤
- **原因 1: 模块路径缺失扩展名**。Node.js ESM 模式下，跨目录引用必须明确。
- **原因 2: Bcryptjs 默认导入兼容性**。在 ESM 下，CJS 库的默认导入可能失效。
- **原因 3: Vercel 运行时的顶层副作用**。

## 3. 解决方案计划
1.  **路径标准化**: 将 API 处理器中的导入语句恢复为带 `.js` 后缀的 ESM 标准写法。
2.  **依赖导入兼容性**: 修改 `bcryptjs` 的导入方式为 `import * as bcrypt from 'bcryptjs'` 或解构导入，确保在 ESM 下可用。
3.  **增加初始化检查**: 在执行业务逻辑前，先验证依赖和配置是否存在。
4.  **强制 Node.js 版本**: 在 `package.json` 中明确指定引擎版本，确保与开发环境接近。

## 4. 验证标准
- 重新部署后，注册接口返回 201 或 400（业务逻辑错误），而非 500（系统崩溃）。
