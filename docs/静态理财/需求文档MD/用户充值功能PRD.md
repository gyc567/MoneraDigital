# 产品需求文档：用户充值功能 (User Deposit)

## 前言
> **核心目标**：为用户提供安全、便捷的数字资产充值（入金）功能。支持多链、多币种充值，确保用户能准确获取充值地址，并实时追踪充值状态，保障资金安全入账。

---

## 一、 版本信息

| 版本号 | 创建日期 | 变更人 | 审核人 |
| :--- | :--- | :--- | :--- |
| V1.0.0 | 2026-01-14 | Eric | 待定 |

---

## 二、 变更日志

| 时间 | 版本号 | 变更人 | 主要变更内容 |
| :--- | :--- | :--- | :--- |
| 2026-01-14 | V1.0.0 | Eric | 文档初始化：定义多链充值流程与交互规范 |

---

## 三、 文档说明

### 名词解释

| 术语 / 缩略词 | 说明 |
| :--- | :--- |
| **充值 (Deposit)** | 用户将数字资产从外部钱包转入本平台账户的过程。 |
| **公链 (Chain)** | 区块链网络，如 Ethereum (ETH), Tron (TRX), Solana (SOL) 等。 |
| **确认数 (Confirmations)** | 区块链上交易被确认的区块数量，达到一定数量后视为入账成功。 |
| **核心账户系统** | 负责生成钱包地址和监听链上交易的底层服务系统。 |

---

## 四、 需求背景

### 产品现状
目前用户完成开户后，需要一个专门的入口来获取充值地址并进行资金转入，以便参与理财投资。

### 用户痛点
*   **地址混淆**：不同链的地址格式不同（如 ERC20 vs TRC20），用户容易选错链导致资产丢失。
*   **状态焦虑**：转账后无法立即看到资金，用户不知道是否到账，需要实时的状态反馈。

---

## 五、 需求范围

1.  **充值主页**：支持选择币种（Asset）和网络（Chain），展示对应的充值地址和二维码。
2.  **地址管理**：复制地址、保存二维码。
3.  **充值记录**：展示历史充值明细及当前状态（确认中/成功/失败）。
4.  **风险提示**：针对不同链的特殊充值要求（如 Memo/Tag）进行强提示。

---

## 六、 功能详细说明

### 1. 业务流程图

> **主流程**：
> 用户点击左侧菜单"充值" -> **进入充值页面** -> 选择币种 (e.g. USDT) -> 选择网络 (e.g. TRON) -> **系统展示 TRC20 地址** -> 用户复制地址/扫码 -> 外部转账 -> **系统监听到账** -> 更新充值记录 -> 通知用户。

### 2. 功能模块详述

#### 模块一：充值页面 (Deposit Page)

**页面目标**：准确展示充值地址，防止用户转错链。

| 序号 | 字段/区域 | 详细逻辑说明 | 交互/展示 |
| :--- | :--- | :--- | :--- |
| 1 | **币种选择** | 下拉框或卡片选择。支持：USDT, USDC。<br>默认选中 USDT。 | 清晰的图标 + 名称。 |
| 2 | **网络选择** | 下拉框或标签选择。支持：<br>- **TRON (TRC20)**：推荐，低手续费<br>- **Ethereum (ERC20)**：主流<br>- **BSC (BEP20)**<br>- **Solana**<br>- **Avalanche**<br>- **Arbitrum / Optimism** | 选中网络后，下方地址区域实时刷新。<br>若某些网络暂停充值，需置灰并提示"维护中"。 |
| 3 | **地址展示区** | 1. **地址文本**：显示完整的钱包地址。<br>2. **脱敏/完整切换**：默认显示完整，中间不省略，防止核对错误。<br>3. **二维码**：对应地址的二维码。 | 核心区域，字体放大。 |
| 4 | **操作按钮** | 1. **复制地址**：点击复制到剪贴板，Toast 提示"复制成功"。<br>2. **保存二维码**：下载二维码图片。 | 明显的图标按钮。 |
| 5 | **风险提示 (重要)** | 红色或黄色背景提示框：<br>"请务必确认您选择的是 **[当前网络]** 网络。充值到其他网络将无法找回。" | 位于地址下方，强视觉提示。 |
| 6 | **最小充值金额** | 提示单笔最小充值金额（如 10 USDT），小于此金额可能无法入账。 | 辅助信息。 |

#### 模块二：充值记录 (Deposit History)

**页面目标**：让用户随时掌握资金动向。

| 序号 | 字段 | 说明 | 状态流转 |
| :--- | :--- | :--- | :--- |
| 1 | **时间** | 交易被系统检测到的时间。 | |
| 2 | **币种/网络** | 如 USDT (TRON)。 | |
| 3 | **数量** | 充值金额。 | |
| 4 | **交易哈希 (TxID)** | 链上 Hash，支持点击跳转到区块浏览器查询。 | |
| 5 | **状态** | **确认中 (Pending)**：链上已确认，等待区块确认数（如 1/12）。<br>**成功 (Confirmed)**：确认数达标，资金已入账。<br>**失败 (Failed)**：异常情况（极少见）。 | 确认中：黄色<br>成功：绿色<br>失败：红色 |

---

## 七、 异常流程与边界条件

1.  **未开户**：
    *   若用户尚未完成"账户开通"流程，进入充值页时，显示"请先激活您的资金账户"，并提供"立即激活"按钮跳转至开户页（或触发开户弹窗）。
2.  **网络维护**：
    *   若核心系统返回某条链状态为"Suspended"，前端应禁用该选项，并提示"钱包维护中，暂停充值"。
3.  **地址获取失败**：
    *   接口报错或超时，显示"地址获取失败，请重试"，提供重试按钮。
4.  **充值未到账**：
    *   提供"未到账反馈"入口或客服联系方式，引导用户提供 TxID 进行人工查询。

---

## 八、 埋点设计

| 事件ID | 事件名称 | 参数 | 说明 |
| :--- | :--- | :--- | :--- |
| `view_deposit_page` | 访问充值页 | `user_id` | 流量统计 |
| `select_asset_chain` | 切换币种/链 | `asset`, `chain` | 统计用户偏好 |
| `copy_deposit_address` | 复制地址 | `chain`, `address` | 统计充值意向 |
| `save_deposit_qrcode` | 保存二维码 | `chain` | 统计充值意向 |

---

## 九、 接口需求 (参考 API 文档)

*   `GET /api/wallet/info`: 获取用户多链地址列表。
*   `GET /api/deposits`: 获取充值历史记录。
*   `POST /api/webhooks/core/deposit`: (后端) 接收充值到账通知。

---

## 十、 安全与风控 (P0)

1.  **地址一致性**：前端展示地址必须严格等于接口返回地址，禁止前端拼接或修改。
2.  **剪贴板劫持防护**：用户点击复制后，建议 Toast 提示"请在转账时再次核对地址"，提醒用户注意剪贴板木马。
3.  **网络强校验**：用户切换网络时，必须清空当前展示的地址，重新加载新网络地址，防止用户在网络切换间隙误复制旧地址。

---
